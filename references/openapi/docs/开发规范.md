---
id: "kdcloud-be00401032c811ef8e9d13ceeccd5e03"
title: "开发规范"
source: "金蝶云社区"
url: "https://open.jdy.com/#/files/api/detail?index=3&categrayId=&id=be00401032c811ef8e9d13ceeccd5e03"
author: ""
published_at: ""
product: "金蝶云苍穹"
module: ["指导文档"]
language: "Kingscript"
version_hint: ["V2"]
keywords: []
quality: "B"
---

# 开发规范

# 1、引言

## 1.1、编写目的

-   为保障金蝶云•星辰生态产品的系统稳定、高效运行，规范集成设计与开发，助力星辰生态业务持续健康发展，结合当前多个生态产品的实际研发和系统上线运行的情况和经验，特制定《金蝶云•星辰集成应用开发规范》，以行业领先标准为要求，提升集成开发质量及客户满意度。
-   本篇文档作为 API 开发指导手册，包含四部分规范：API文档规范、API 调用规范、API 错误码规范和 API 安全规范。
-   本文档用于指引开发者进行金蝶产品组合集成，提升产品组合的效率和质量。

## 1.2、OpenAPI整体介绍

-   金蝶云•星辰的OpenAPI致力于提供符合Restful规范的接口，将企业数据及业务能力API化，全面覆盖各领域开放接口的使用场景，用户可以简单、安全、低成本地实现内外部系统集成和业务能力的开放。
-   应用程序编程接口（Application Programming Interface，API 接口），是应用程序重要的组成部分，是应用程序对外提供的一个操作数据入口，可以是一个函数或类方法，也可以是一个 url 地址或者一个网络地址。当客户端调用这个入口，应用程序则会执行对应代码操作，给客户端完成相对应的功能。

## 1.3、适用范围

-   本办法适用于金蝶软件（中国）有限公司（以下简称“金蝶中国”）总部、下属分公司（以下简称“机构”）及各子公司和ISV伙伴，通过OpenAPI参与星辰&生态集成开发的研发人员。
-   产品范围：金蝶云星辰标准版、金蝶云星辰专业版、金蝶云星辰旗舰版。

## 1.4、参考

-   [《金蝶云苍穹OpenAPI开发规范》](https://vip.kingdee.com/knowledge/specialDetail/226337046514476288?category=450969352477588480&id=367256698861227008)
-   [《金蝶云苍穹OpenAPI接口规范》](https://vip.kingdee.com/knowledge/specialDetail/226337046514476288?category=450969352477588480&id=448792125560557568)

## 1.5、说明

依据约束力强弱及故障敏感性， 规约依次分为【强制】 、【推荐】两大类。 在延伸信息中，“说明” 对规约做了适当扩展和解释。

# 2、API文档规范

调用OpenAPI仅支持HTTPS 协议作为传输协议，以确保传输数据的安全性。 默认报文格式为JSON，报文格式由具体服务接口定义。

## 2.1、请求URL

小微开放平台发布的接口地址为URL，拼接 https://动态域名/jdy 组成完整请求地址，形如：https://api.kingdee.com/jdy/v2/sys/xxxxxx。

## 2.2、请求方式

调用接口的请求方式主要有GET和POST。

-   GET请求主要用于向指定的资源发出“显示"请求。使用GET方法应该只用在获取数据，但是传递的参数则显示在地址栏，安全性低，且参数的长度也有限制（2048字符）；

-   POST请求则用于向指定资源提交数据，请求服务器进行处理例如保存单据或基础资料。这个请求可能会创建新的资源或修改现有资源，或二者皆有。将传递的参数放在request body中，不会在地址栏显示，安全性比get请求高，参数没有长度限制。

## 2.3、Headers参数规范

每次调用接口都必须传如下headers参数（不区分大小写）。

| 参数名称 | 参考示列 | 说明 |
| --- | --- | --- |
| Content-Type | application/json | 请求类型，固定值为 application/json |
| X-Api-ClientID | 205022 | 应用 id，开发者在小微开发者后台创建应用的应用 id，参考【[**创建指引**](https://open.jdy.com/#/files/api/detail?index=3&categrayId=316e1f5bd9d711ed8e36c17691e84ff5&id=a540e3dcd9d811ed8e3677dc79b66e86)】 |
| X-Api-Auth-Version | 2.0 | 接口版本号，固定值为 2.0 |
| X-Api-TimeStamp | 1655775240000 | 时间戳，取当前时间的毫秒时间戳，值为长度 13 位的数字 |
| X-Api-SignHeader | X-Api-TimeStamp,X-Api-Nonce | 参与签名的 headers 参数名称，固定值为 X-Api-TimeStamp,X-Api-Nonce |
| X-Api-Nonce | 1655775240000 | 随机正整数，取当前时间的时间戳或随机数字，用于预防 CSRF 攻击 |
| X-Api-Signature | xxx | 签名串，按一定规则生成的签名校验字符串，参考【[**加密规则**](https://open.jdy.com/#/files/api/detail?index=4&categrayId=5403e0fd6a5811eda819b759130d6d33&id=b5c26557da9d11ed8e36f9799578d2e1)】 |
| app-token | xxx | 业务接口的 token，绑定账套后会生成此token，参考【[**获取指引**](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=9076d1a6da9d11ed8e36874bed64e0be&noside=true)】 |
| X-GW-Router-Addr | https://tf.jdy.com/ | Openapi 的后端地址–IDC 域名，获取appKey 返回消息体内的 domain 字段，参考【[**实时接收授权**](https://open.jdy.com/#/files/api/detail?index=4&categrayId=5403e0fd6a5811eda819b759130d6d33&id=78574825da9d11ed8e36c1d0700f007b)】 |

## 2.4、响应参数规范

每次调用接口的HTTP Status Code为200 OK时，都会返回如下参数。

| 参数 | 说明 |
| --- | --- |
| errcode | 业务返回码，业务处理成功返回码为 0，业务处理失败返回码大于 0。 |
| description | 业务处理结果描述，业务处理成功返回 success，业务处理失败返回具体失败的原因。 |
| data | 业务处理结果对象，业务返回的具体对象。 |

# 3、API调用规范

-   在客户端调用API接口过程中常见的有高频调用、大批量数据和幂等性问题，其中大批量数据保存，由于一次查询或保存的数据量太大，很可能会造成接口超时问题。
-   幂等性是指任意多次请求的执行结果和一次请求的执行结果所产生的影响相同。查询操作无论查询多少次都不会影响数据本身，因此查询操作本身就是幂等的。但是新增操作，每执行一次数据库就会发生变化，所以它是非幂等的。
-   在实际的项目上，如果出现高并发或网络异常的情况，例如Nginx在网络异常时会重复转发请求，可能会生成重复生成数据或多次提交请求的。比如订单创建时，我们需要去减库存，这时接口发生了超时，调用方进行了重试，很可能就出现多扣一次库存的情况。
-   因此为保证接口可靠性和稳定性，客户端在调用时应遵守相关规范。

| 调用方规范 | 规范说明 |
| --- | --- |
| Token 及认证 | 目前支持 2 种认证方式：app-token 认证和签名认证（X-Api-Signature）。app-token 有效期一般为 24 小时，客户端应缓存 app-token，不应每次调用API 时重复请求获取 app-token，即将过期时可通过刷新 token 换取新的 app-token。 |
| 重复调用控制 | 在每次请求时 header 中参数 X-Api-TimeStamp 在客户端获取当前时间的毫秒时间戳（长度为 13 位的数字），该值 5 分钟内有效。当同一个请求第二次访问时，系统识别到 X-Api-TimeStamp 超过 5 分钟，系统就认为是重复提交了，系统会拒绝请求。 |
| 请求数据量控制 | 单次调用最长响应时间不得超过 30 秒。大数据量处理必须做好分页控制，单次查询请求（包含分录）不得超过 1000 条，保存请求不得超过 500 条。 |
| 请求频次限制 | 每个接口默认 400 次/秒，最大 1000 次/秒。 |

# 4、API错误码规范

方便快速定位接口问题，保证用户统一的API使用体验。

## 4.1、网关标准错误码规范

遵循集团网关统一错误码的，范围从0 – 999。
以下是网关标准错误码的一些示例：

| 类别 | 错误码 | 描述 |
| --- | --- | --- |
| 网关标准错误码 | 0 | OK - 请求成功 |
| 网关标准错误码 | 400 | 参数无效 - 请求参数有误或缺失 |
| 网关标准错误码 | 401 | 未授权访问（Token 无效） |
| 网关标准错误码 | 403 | 禁止访问（IP 限制等） |
| 网关标准错误码 | 429 | API 被限流 - 请求过于频繁 |
| 网关标准错误码 | 404 | API 不存在 - 请求的 API 不存在 |
| 网关标准错误码 | 500 | 服务异常，服务内部错误 |
| 网关标准错误码 | 503 | 服务暂时不可用，例如：停机维护 |
| 网关标准错误码 | 504 | 请求的服务超时 - 等待服务响应超时 |

## 4.2、业务领域错误码规范

错误码总共10位十进制（数字），采用4段式定义（形如：AABBCCDEEE），范围 2000000000 – 2999999999：

-   第1段的AA位上的数字代表产品系统：20 - 星辰
-   第2段的BB位上的数字代表不同产品系统下个服务：
    00 – 默认、11 - 系统云、12 - 开发服务云、13 - 流程服务云、14 - 数据服务云、15 - 财务云、16 - 供应链云、17 - 订货云、18 - 零售云、19-小微管理中心、20-业务中台
-   第3段的CC位上的数字代表产品服务下子模块：00 – 默认
-   第4段的D位上的数字代表最上级解决角色：1 – 运维、2 – 开发者、3– 客户
-   第5段的EEE位上的数字代表具体错误编码：

| 类别 | 错误码范围 | 示例 |
| --- | --- | --- |
| 业务领域错误码 | 2000000000 - 2999999999 | 示例（以实际调用为准）：2015002000 – 财务云系统错误；2016002095 – 第%d 行分录的商品和外部商品至少录入一个 |

## 4.3、共用返回码

实际接口返回信息内容可能并不与“含义”完全一致，可能根据实际情况调整，但基本含义不变。

| 返回码 | 描述 | 建议处理方案 |
| --- | --- | --- |
| 1000002001 | 服务异常 |  |
| 1020002008 | 用户授权信息有误 | 确认appKey是否正确 |
| 1030002000 | {{必填字段}}不能为空 |  |
| 1030002001 | {{字段}} 类型不正确，请根据字段要求正确传输有效值 |  |
| 1030002002 | {{对象}}已存在，不能重复新增 |  |
| 1030002003 | {{对象\\类型\\属性}}不存在 |  |
| 1030002004 | {{对象\\类型\\属性}} 已被其他对象使用，无法删除 |  |
| 1030002005 | 操作对象个数超出限制 |  |
| 1030002006 | {{字段}}格式不正确，请根据字段要求正确传输有效值 |  |
| 1040002000 | 配置有误，请正确配置XXX | 联系工作人员配置client |
| 1040003000 | 请前往XXX进行配置 | 客户自行操作配置 |

## 4.4、业务返回码

| 返回码 | 含义 | 建议处理方案 |
| --- | --- | --- |
| 2000002000 | 星辰系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2011002000 | 星辰系统云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2012002000 | 星辰开发服务云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2013002000 | 星辰流程服务云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2014002000 | 星辰数据服务云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2015002000 | 星辰财务云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2016002000 | 星辰供应链云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2016002095 | 第%d行分录的商品和外部商品至少录入一个 |  |
| 2016002096 | 第%s行分录的商品和外部商品\[%s\]不匹配，请检查 |  |
| 2016002097 | 第%s行分录的外部商品\[%s\]未匹配到商品，请检查，请检查所传供应商、外部商品等是否正确 |  |
| 2016002098 | 根据外部商品\[%s\]的外部单位\[%s\]，未匹配到系统商品单位，请检查 |  |
| 2016002099 | 外部商品\[%s\]的外部单位为空，请先维护对应的外部单位 |  |
| 2016012098 | 供应商不存在，请检查所传供应商是否正确 |  |
| 2016012099 | 供应商必填 |  |
| 2016012099 | 客户不存在，请检查所传客户是否正确 |  |
| 2016022099 | 客户必填 |  |
| 2016003063 | 汇率不能为零 |  |
| 2016043007 | 预收款单的源单类型必须是销售订单 |  |
| 2016043008 | 预付款单的源单类型必须是采购订单 |  |
| 2016043009 | 本次预收金额合计不等于收款总金额! |  |
| 2016043010 | 未找到源单或源单未审核或订单已关闭！%s:%s |  |
| 2016043023 | 预付退款单的源单类型必须是预付款单 |  |
| 2016043021 | 预收退款单的源单类型必须是预收款单 |  |
| 2016043013 | 本次核销总金额不等于本次退款总金额! |  |
| 2016043014 | 源单可核销金额不足! |  |
| 2016043016 | 本次核销总金额不等于本次付款总金额! |  |
| 2016043017 | 不支持付款：付款金额与源单待付款金额方向不匹配! |  |
| 2016043025 | 本次核销金额超过未核销金额，请检查! |  |
| 2017002000 | 星辰订货云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2018002000 | 星辰零售云系统错误,请到开发者社区提单反馈+traceId | https://vip.kingdee.com/developer?productLineId=29 |
| 2018013001 | 存在未核销的预收款余额，不允许关联客户，以免造成客户应收账款统计异常。 |  |
| 2018023005 | 只有已审核状态的要货单才能被复制 |  |
| 2018023006 | 该门店没有上架商品 |  |
| 2018023007 | 该单据为审核状态，不允许修改 |  |
| 2018023016 | 该要货单已经审核，请不要重复审核 |  |
| 2018023017 | 不允许审核所有明细中实际要货数都为0的要货单 |  |
| 2018023019 | 存在绑定的配货单，不允许作废 |  |
| 2018023020 | 只有未审核的要货单允许作废 |  |
| 2018023021 | 只有已审核的要货单可以关闭 |  |
| 2018023022 | 只有已审核的要货单可以反审核 |  |
| 2018023023 | 存在绑定的配货单,不可反审核 |  |
| 2018013015 | 未设置门店结算方式或结算方式不正确 | 在门店管理-门店结算方式中设置结算方式 |

# 5、API安全规范

## 5.1、认证鉴权

-   签名认证：通过headers参数X-Api-Signature（即，签名串）进行签名校验认证, X-Api-Signature生成规则参考小微开放平台签名生成规则文档。
-   Token认证：星辰OpenAPI认证鉴权除了签名认证还要通过app-token认证，获取app-token需要的clientId、appKey、appSecret 三个参数通过小微开发者后台申请。clientId是开发者申请的应用ID，appKey是账套级别，每个appKey将绑定一个授权账套，appSecret需要客户端高度保密。
    【强制】：OpenAPI客户端应做缓存（app-token默认24小时有效），客户端需要每天定期获取一次app-token。

## 5.2、黑名单

【强制】针对第三方应用出现的违规行为或调用API异常未及时处理的行为，我们将把第三方应用纳入黑名单，纳入黑名单的第三方应用无法正常调用接口，需要整改后或修复调用API的异常问题后，申请移除黑名单才能恢复正常调用。

## 5.3、限流策略

【强制】限流是为了更好的维护系统稳定性，在高并发时，避免瞬间高峰接口压垮系统服务。
OpenAPI支持配置限流策略，按第三方应用和API维度维护单位时间内的访问次数上限，高频的接口调用系统会自动拒绝。 目前星辰OpenAPI限流有两个层面组成：

-   4网关层限流：是针对每个接口的调用限流。例如，单个接口第三方应用的请求限制是100次/秒
-   5业务账套层限流：是针对某个业务账套数据请求的限流。例如，单个账套请求限制是 500 次/分钟

## 5.4、接口防篡改

【强制】API参数篡改就是恶意人通过抓包的方式获取到请求的接口的参数，通过修改相关的参数，达到欺骗服务器的目的，OpenAPI防止篡改的方式是用签名和相同参数重复请求的控制。
OpenAPI签名认证是目前第三方系统和金蝶云最高的认证方式，采用双向签名认证+相同参数拒绝重复请求的模式，解决了第三方系统和金蝶云安全高效的接口交互，支持接口参数防篡改，数据完整性和隐私安全性。

## 5.5、数据加密与脱敏

【强制】在接口调用过程中有些敏感参数（如登录密码、支付密码）通常需要加密处理等，而最后响应结果中若包含用户手机号、用户邮箱、身份证号等信息，则需要进行脱敏处理。通过开放平台第三方应用加密策略和隐私中心，可对敏感信息进行加密和脱敏，保证API数据安全。

# 6、第三方系统连接规范

【强制】禁止将秘钥（clientSecret、appSecret），域名信息直接编写在代码中。说明：对接开发/测试/生产环境各不相同，应通过系统配置文件全局配置。
【强制】如第三方系统鉴权信息具有时效性（而非一次有效），则需将app-token信息进行缓存，并设计刷新机制。严禁每次调用接口均调用获取app-token接口。

# 7、数据集成开发规范

【强制】禁止在客户未知情的情况下采集客户账套数据。
【推荐】发布接口供外部系统调用，参考OpenAPI开发规范。
【推荐】对API响应超时情况，需设置访问超时时间限制。
【推荐】对于外部系统网络环境恶劣或不稳定情况，或API禁止频繁调用场景，应限流，以限制调用频率。
【推荐】对于API调用锚点，建议将其摘要信息打印到系统日志中，但严禁频繁打印非必要日志，严禁频繁打印全量数据包日志。
【推荐】对于非幂等性重要API接口，应设置防重调用机制。

## 7.1、安全规范

【强制】禁止将秘钥、连接信息、域名等信息硬编码在代码中。
【强制】从正式环境恢复数据到测试环境，一定要执行脱敏脚本，防止篡改其他环境的数据。
【强制】禁止在正式环境执行未经测试验证通过的集成资源或直接更改正式环境集成资源配置；
【推荐】涉密信息使用加密传输、敏感信息进行脱敏传输。

## 7.2、性能规范

【推荐】转换逻辑尽量避免循环SQL查询，建议使用批量查询并结合缓存机制。
【推荐】超高量级数据集成，应设计分批、多线程机制。
【强制】数据库集成取数时，过滤条件添加索引；写数时，候选键字段设置索引。
【推荐】大规模数据集成，必须有相应的技术方案设计。
【推荐】对于源数据较大、需要转换场景，推荐使用中间表的方式，先保证数据落库，之后进行转换处理。
