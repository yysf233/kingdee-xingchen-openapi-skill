---
id: "kdcloud-9d2e7790712511eda0b38f0798768f77"
title: "外部单据保存"
source: "金蝶云社区"
url: "https://open.jdy.com/#/files/api/detail?index=3&categrayId=&id=9d2e7790712511eda0b38f0798768f77"
author: ""
published_at: ""
product: "金蝶云苍穹"
module: ["财税云", "凭证", "外部单据"]
language: "Kingscript"
version_hint: ["V2"]
keywords: []
quality: "B"
---

# 外部单据保存

### 基本信息

-   用途说明：外部单据新增及修改。审核、删除等详见[通用操作接口](https://open.jdy.com/#/files/api/detail?index=2&categrayId=3cc8ee9a663e11eda5c84b5d383a2b93&id=9e804b8c712511eda0b39f724d124b07)
-   请求方式：POST
-   请求地址：https://api.kingdee.com/jdy/v2/fi/virtual

### 请求参数

#### headers参数

| 参数名称 | 参数示例 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| Content-Type | application/json | true | 固定传：application/json |
| X-Api-ClientID | 205022 | true | 应用id，[创建指引](https://open.jdy.com/#/files/api/detail?index=3&categrayId=316e1f5bd9d711ed8e36c17691e84ff5&id=a540e3dcd9d811ed8e3677dc79b66e86&noside=true) |
| X-Api-Auth-Version | 2.0 | true | 固定传:2.0 |
| X-Api-TimeStamp | 1655775240000 | true | 当前时间毫秒时间戳，有效期为5min |
| X-Api-SignHeaders | X-Api-TimeStamp,X-Api-Nonce | true | 固定传：X-Api-TimeStamp,X-Api-Nonce |
| X-Api-Nonce | 1655775240000 | true | 随机正整数 |
| X-Api-Signature | xxx | true | [参考加密规则](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=b5c26557da9d11ed8e36f9799578d2e1&noside=true) |
| app-token | xxx | true | 产品账套级别的token，[获取指引](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=9076d1a6da9d11ed8e36874bed64e0be&noside=true) |
| X-GW-Router-Addr | https://tf.jdy.com | true | IDC域名，获取appKey返回消息体内的domain字段 |

#### body参数

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| items | List <Item> | false | 列表 |

**Item**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| bill\_no | string | true | 编码 |
| entry | List <Entry> | true | 分录列表 |
| bill\_amount | number | false | 金额 |
| bill\_custom\_amount1 | string | false | 自定义金额1 |
| bill\_custom\_amount2 | string | false | 自定义金额2 |
| bill\_custom\_amount3 | string | false | 自定义金额3 |
| bill\_custom\_amount4 | string | false | 自定义金额4 |
| bill\_custom\_amount5 | string | false | 自定义金额5 |
| bill\_custom\_amount\_for1 | string | false | 自定义本位币金额1 |
| bill\_custom\_amount\_for2 | string | false | 自定义本位币金额2 |
| bill\_custom\_amount\_for3 | string | false | 自定义本位币金额3 |
| bill\_custom\_amount\_for4 | string | false | 自定义本位币金额4 |
| bill\_custom\_amount\_for5 | string | false | 自定义本位币金额5 |
| bill\_custom\_item1\_id | string | false | 自定义项目1id（如果在单据字段设置中设置了自定义项目1的对应项目类别为客户，则此字段只能填写客户的id，billcustomitem2~5\_id 同理 |
| bill\_custom\_item2\_id | string | false | 自定义项目2id |
| bill\_custom\_item3\_id | string | false | 自定义项目3id |
| bill\_custom\_item4\_id | string | false | 币别自定义项目4id编码 |
| bill\_custom\_item5\_id | string | false | 自定义项目5id |
| bill\_custom\_item\_type1 | string | false | 自定义项目1类型，如已设置客户，则需传入bd\_customer，billcustomitemtype2~5 同理 |
| bill\_custom\_item\_type2 | string | false | 自定义项目2类型 |
| bill\_custom\_item\_type3 | string | false | 自定义项目3类型 |
| bill\_custom\_item\_type4 | string | false | 自定义项目4类型 |
| bill\_custom\_item\_type5 | string | false | 自定义项目5类型 |
| bill\_custom\_text1 | string | false | 自定义文本1 |
| bill\_custom\_text2 | string | false | 自定义文本2 |
| bill\_custom\_text3 | string | false | 自定义文本3 |
| bill\_custom\_text4 | string | false | 自定义文本4 |
| bill\_custom\_text5 | string | false | 自定义文本5 |
| bill\_date | string | false | 单据日期yyy-mm-dd |
| currency\_id | string | false | 币别id |
| currency\_number | string | false | 币别编码 |
| customer\_id | string | false | 客户id |
| customer\_number | string | false | 客户编码 |
| dept\_id | string | false | 部门id |
| dept\_number | string | false | 部门编码 |
| emp\_id | string | false | 业务员id |
| emp\_number | string | false | 业务员编码 |
| exchange\_rate | number | false | 汇率 |
| group\_id | string | false | 外部单据分类id |
| group\_number | string | false | 外部单据分类编码 |
| id | string | false | id |
| remark | string | false | 备注 |
| supplier\_id | string | false | 供应商id |
| supplier\_number | string | false | 供应商编码 |

**Entry**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| amount | string | true | 金额 |
| custom\_amount\_for10 | string | false本位币 | 自定义本位币金额10 |
| custom\_amount\_for5 | string | false本位币 | 自定义本位币金额5 |
| custom\_amount\_for6 | string | false本位币 | 自定义本位币金额6 |
| custom\_amount\_for7 | string | false本位币 | 自定义本位币金额7 |
| custom\_amount\_for8 | string | false本位币 | 自定义本位币金额8 |
| custom\_amount\_for9 | string | false本位币 | 自定义本位币金额9 |
| amount\_for | string | false | 金额-本位币 |
| bank\_id | string | false | 银行账号id |
| bank\_number | string | false | 银行账号编码 |
| comment | string | false | 备注 |
| custom\_amount1 | string | false | 自定义金额1 |
| custom\_amount10 | string | false | 自定义金额10 |
| custom\_amount2 | string | false | 自定义金额2 |
| custom\_amount3 | string | false | 自定义金额3 |
| custom\_amount4 | string | false | 自定义金额4 |
| custom\_amount5 | string | false | 自定义金额5 |
| custom\_amount6 | string | false | 自定义金额6 |
| custom\_amount7 | string | false | 自定义金额7 |
| custom\_amount8 | string | false | 自定义金额8 |
| custom\_amount9 | string | false | 自定义金额9 |
| custom\_amount\_for1 | string | false | 自定义本位币金额1 |
| custom\_amount\_for2 | string | false | 自定义本位币金额2 |
| custom\_amount\_for3 | string | false | 自定义本位币金额3 |
| custom\_amount\_for4 | string | false | 自定义本位币金额4 |
| custom\_item\_id1 | string | false | 自定义项目id1。举例，若按照部门核算，则传部门id，若按照辅助资料核算，则传辅助资料id，其他核算项目同理 |
| custom\_item\_id10 | string | false | 自定义项目id10 |
| custom\_item\_id2 | string | false | 自定义项目id2 |
| custom\_item\_id3 | string | false | 自定义项目id3 |
| custom\_item\_id4 | string | false | 自定义项目id4 |
| custom\_item\_id5 | string | false | 自定义项目id5 |
| custom\_item\_id6 | string | false | 自定义项目id6 |
| custom\_item\_id7 | string | false | 自定义项目id7 |
| custom\_item\_id8 | string | false | 自定义项目id8 |
| custom\_item\_id9 | string | false | 自定义项目id9 |
| custom\_item\_number1 | string | false | 自定义项目编码1。举例，若按照部门核算，则传部门number，若按照辅助资料核算，则传辅助资料number，其他核算项目同理 |
| custom\_item\_number10 | string | false | 自定义项目编码10 |
| custom\_item\_number2 | string | false | 自定义项目编码2 |
| custom\_item\_number3 | string | false | 自定义项目编码3 |
| custom\_item\_number4 | string | false | 自定义项目编码4 |
| custom\_item\_number5 | string | false | 自定义项目编码5 |
| custom\_item\_number6 | string | false | 自定义项目编码6 |
| custom\_item\_number7 | string | false | 自定义项目编码7 |
| custom\_item\_number8 | string | false | 自定义项目编码8 |
| custom\_item\_number9 | string | false | 自定义项目编码9 |
| custom\_text1 | string | false | 自定义文本1 |
| custom\_text10 | string | false | 自定义文本10 |
| custom\_text2 | string | false | 自定义文本2 |
| custom\_text3 | string | false | 自定义文本3 |
| custom\_text4 | string | false | 自定义文本4 |
| custom\_text5 | string | false | 自定义文本5 |
| custom\_text6 | string | false | 自定义文本6 |
| custom\_text7 | string | false | 自定义文本7 |
| custom\_text8 | string | false | 自定义文本8 |
| custom\_text9 | string | false | 自定义文本9 |
| dis\_amount | string | false | 折扣 |
| dis\_amount\_for | string | false | 本位币折扣 |
| id | string | false | 分录id |
| material\_id | string | false | 商品id |
| material\_number | string | false | 商品编码 |
| pacct\_type\_id | string | false | [收入类别id](https://open.jdy.com/#/files/api/detail?index=3&categrayId=3cc8ee9a663e11eda5c84b5d383a2b93&id=9ca83052712511eda0b3fb728b849f6b) |
| pacct\_type\_number | string | false | 收入类别编码 |
| payout\_type\_id | string | false | [支出类别id](https://open.jdy.com/#/files/api/detail?index=3&categrayId=3cc8ee9a663e11eda5c84b5d383a2b93&id=9cb1f455712511eda0b3f9a4bd5a6b8e) |
| payout\_type\_number | string | false | 支出类别编码 |
| price | string | false | 单价 |
| qty | string | false | 数量 |
| stock\_id | string | false | 仓库id |
| stock\_number | string | false | 仓库编码 |
| tax\_amount | string | false | 税额 |
| tax\_amount\_for | string | false | 本位币税额 |
| unit\_id | string | false | 单位id |
| unit\_number | string | false | 单位编码 |

#### 请求示例

```bash
curl --location --request  post 'https://api.kingdee.com/jdy/v2/fi/virtual' \
--header 'Content-Type: application/json' \
--header 'X-Api-ClientID: 205022' \
--header 'X-Api-Auth-Version: 2.0' \
--header 'X-Api-TimeStamp: 1655775240000' \
--header 'X-Api-Nonce: 1655775240000' \
--header 'X-Api-SignHeaders: X-Api-TimeStamp,X-Api-Nonce' \
--header 'X-Api-Signature: xxx' \
--header 'app-token: xxx' \
--header 'X-GW-Router-Addr: https://tf.jdy.com' \
--data-row ' { 	"items":[ 		{ 			"bill_amount":100, 			"bill_custom_amount1":"100", 			"bill_custom_amount2":"100", 			"bill_custom_amount3":"100", 			"bill_custom_amount4":"100", 			"bill_custom_amount5":"100", 			"bill_custom_amount_for1":"100", 			"bill_custom_amount_for2":"001", 			"bill_custom_amount_for3":"100", 			"bill_custom_amount_for4":"100", 			"bill_custom_amount_for5":"100", 			"bill_custom_item1_id":"001", 			"bill_custom_item2_id":"001", 			"bill_custom_item3_id":"001", 			"bill_custom_item4_id":"001", 			"bill_custom_item5_id":"001", 			"bill_custom_item_type1":"bd_material", 			"bill_custom_item_type2":"bd_material", 			"bill_custom_item_type3":"bd_material", 			"bill_custom_item_type4":"bd_material", 			"bill_custom_item_type5":"bd_material", 			"bill_custom_text1":"bd_auxinfo", 			"bill_custom_text2":"bd_auxinfo", 			"bill_custom_text3":"bd_auxinfo", 			"bill_custom_text4":"bd_auxinfo", 			"bill_custom_text5":"bd_auxinfo", 			"bill_date":"2022-07-15", 			"bill_no":"001", 			"currency_id":"1", 			"currency_number":"001", 			"customer_id":"1", 			"customer_number":"001", 			"dept_id":"1", 			"dept_number":"001", 			"emp_id":"1", 			"emp_number":"001", 			"entry":[ 				{ 					"amount":"100", 					"amount_for":"100", 					"bank_id":"1", 					"bank_number":"001", 					"comment":"无", 					"custom_amount1":"100", 					"custom_amount10":"100", 					"custom_amount2":"100", 					"custom_amount3":"100", 					"custom_amount4":"100", 					"custom_amount5":"100", 					"custom_amount6":"100", 					"custom_amount7":"100", 					"custom_amount8":"100", 					"custom_amount9":"100", 					"custom_amount_for1":"100", 					"custom_amount_for10":"100", 					"custom_amount_for2":"100", 					"custom_amount_for3":"100", 					"custom_amount_for4":"100", 					"custom_amount_for5":"100", 					"custom_amount_for6":"100", 					"custom_amount_for7":"100", 					"custom_amount_for8":"100", 					"custom_amount_for9":"100", 					"custom_item_id1":"bd_auxinfo", 					"custom_item_id10":"bd_auxinfo", 					"custom_item_id2":"bd_auxinfo", 					"custom_item_id3":"bd_auxinfo", 					"custom_item_id4":"bd_auxinfo", 					"custom_item_id5":"bd_auxinfo", 					"custom_item_id6":"bd_auxinfo", 					"custom_item_id7":"bd_auxinfo", 					"custom_item_id8":"bd_auxinfo", 					"custom_item_id9":"bd_auxinfo", 					"custom_item_number1":"bd_auxinfo", 					"custom_item_number10":"bd_auxinfo", 					"custom_item_number2":"bd_auxinfo", 					"custom_item_number3":"bd_auxinfo", 					"custom_item_number4":"bd_auxinfo", 					"custom_item_number5":"bd_auxinfo", 					"custom_item_number6":"bd_auxinfo", 					"custom_item_number7":"bd_auxinfo", 					"custom_item_number8":"bd_auxinfo", 					"custom_item_number9":"bd_auxinfo", 					"custom_text1":"bd_auxinfo", 					"custom_text10":"bd_auxinfo", 					"custom_text2":"bd_auxinfo", 					"custom_text3":"bd_auxinfo", 					"custom_text4":"bd_auxinfo", 					"custom_text5":"bd_auxinfo", 					"custom_text6":"bd_auxinfo", 					"custom_text7":"bd_auxinfo", 					"custom_text8":"bd_auxinfo", 					"custom_text9":"bd_auxinfo", 					"dis_amount":"1", 					"dis_amount_for":"1", 					"id":"1", 					"material_id":"1", 					"material_number":"001", 					"pacct_type_id":"1", 					"pacct_type_number":"001", 					"payout_type_id":"1", 					"payout_type_number":"001", 					"price":"100", 					"qty":"1", 					"stock_id":"1", 					"stock_number":"001", 					"tax_amount":"80", 					"tax_amount_for":"80", 					"unit_id":"1", 					"unit_number":"001" 				} 			], 			"exchange_rate":1, 			"group_id":"1", 			"group_number":"001", 			"id":"1", 			"remark":"无", 			"supplier_id":"1", 			"supplier_number":"001" 		} 	] }'
```

### 响应参数

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| errcode | integer | 返回码，成功时为0 |
| description | string | 返回信息，成功时为success，失败时为具体信息 |
| data | Data | 业务返回具体对象 |

**Data**

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| rows | List <VirtualSaveResp> | 保存单据返回数组 |

**VirtualSaveResp**

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| errors | List <Error> | 失败信息数组 |
| id\_number\_map | Map <string> | id与编码map |
| ids | List <string> | 单据id数组对象 |
| message | string | 失败信息 |
| success | boolean | 保存结果 |

**Error**

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| id | string | id |
| messages | string | 信息 |

#### 响应示例

```json
{
  "data": {
    "rows": [
      {
        "errors": [
          {
            "id": "100",
            "messages": "100"
          }
        ],
        "id_number_map": {},
        "ids": [
          "1"
        ],
        "message": "qq",
        "success": 100
      }
    ]
  },
  "description": "success",
  "errcode": 0
}
```

#### 返回码

| 返回码 | 描述 | 解决方案 |
| --- | --- | --- |
| [公告返回码](https://open.jdy.com/#/files/api/detail?index=2&categrayId=1f51c576013945e2af68ef15d4245a48&id=525e704824d24b178ab466530456c037) | 公告返回码 |  |
| 2000002000 | 系统错误,请到开发者社区提单反馈 | [开发者社区](https://vip.kingdee.com/developer?productLineId=29) |
