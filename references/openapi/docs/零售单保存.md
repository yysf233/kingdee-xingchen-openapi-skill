---
id: "kdcloud-9d4b275c712511eda0b3c3d6ecdee2d2"
title: "零售单保存"
source: "金蝶云社区"
url: "https://open.jdy.com/#/files/api/detail?index=3&categrayId=&id=9d4b275c712511eda0b3c3d6ecdee2d2"
author: ""
published_at: ""
product: "金蝶云苍穹"
module: ["零售云", "门店管理", "零售单"]
language: "Kingscript"
version_hint: ["V2"]
keywords: []
quality: "B"
---

# 零售单保存

### 基本信息

-   用途说明：零售单新增及修改。审核、删除等详见[通用操作接口](https://open.jdy.com/#/files/api/detail?index=2&categrayId=3cc8ee9a663e11eda5c84b5d383a2b93&id=9e804b8c712511eda0b39f724d124b07)
-   请求方式：POST
-   请求地址：https://api.kingdee.com/jdy/v2/ls/retail\_bill

### 请求参数

#### headers参数

| 参数名称 | 参数示例 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| Content-Type | application/json | true | 固定传：application/json |
| X-Api-ClientID | 205022 | true | 应用id，[创建指引](https://open.jdy.com/#/files/api/detail?index=3&categrayId=316e1f5bd9d711ed8e36c17691e84ff5&id=a540e3dcd9d811ed8e3677dc79b66e86&noside=true) |
| X-Api-Auth-Version | 2.0 | true | 固定传:2.0 |
| X-Api-TimeStamp | 1655775240000 | true | 当前时间毫秒时间戳，有效期为5min |
| X-Api-SignHeaders | X-Api-TimeStamp,X-Api-Nonce | true | 固定传：X-Api-TimeStamp,X-Api-Nonce |
| X-Api-Nonce | 1655775240000 | true | 随机正整数 |
| X-Api-Signature | xxx | true | [参考加密规则](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=b5c26557da9d11ed8e36f9799578d2e1&noside=true) |
| app-token | xxx | true | 产品账套级别的token，[获取指引](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=9076d1a6da9d11ed8e36874bed64e0be&noside=true) |
| X-GW-Router-Addr | https://tf.jdy.com | true | IDC域名，获取appKey返回消息体内的domain字段 |

#### body参数

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| amt | string | true | 订单金额 |
| material\_entries | List <MaterialEntries> | true | 商品分录 |
| src\_bill\_id | string | true | 商城单据内码 |
| store\_id | string | true | 门店ID |
| bal\_amount | string | false | 支付单编号结算金额(订单实收金额)c=30 |
| bill\_date | string | false | 下单时间，不填以系统时间为准，格式yyyy-MM-dd HH:mm:ss |
| bill\_no | string | false | 零售单据编码 |
| client\_id | string | false |  |
| create\_time | string | false | 创建时间，yyyy-MM-dd HH:mm:ss |
| delivery\_code | string | false | 自提码 |
| delivery\_end\_time | string | false | 配送预约结束时间，yyyy-MM-dd HH:mm:ss |
| delivery\_start\_time | string | false | 配送预约开始时间，yyyy-MM-dd HH:mm:ss |
| delivery\_type | string | true | 1 现提, 2 自提, 3、同城配送，4、快递 5、店内配送 |
| discount\_fee | string | false | 整单优惠，包括积分抵现金额，优惠券优惠金额 |
| encrypt\_key | string | false | 重新上传固定值为字符串"1" |
| lack\_tip | string | false | 缺货提示，1-订单取消，2-协商，3-发已有 |
| member\_deals | MemberDeals | false | 会员业务 |
| member\_id | string | false | 会员ID |
| modify\_time | string | false | 修改时间，yyyy-MM-dd HH:mm:ss |
| order\_status | string | false | 交易状态，外部系统单据状态 |
| promotion\_details | List <PromotionDetails> | false | 优惠明细分录 |
| promotion\_summary | List <PromotionSummary> | false | 优惠汇总分录 |
| receiver\_address | string | false | 收货人的详细地址，如果没有使用星辰地址库，请传收货地址全量信息 |
| receiver\_address\_id | string | false | 收货人地址ID,星辰地址库中的ID，如果没有使用星辰地址库，不需要传 |
| receiver\_latitude | string | false | 收货人的纬度 |
| receiver\_longitude | string | false | 收货人的经度 |
| receiver\_mobile | string | false | 收货人的电话号码 |
| receiver\_name | string | false | 收货人名称 |
| remark | string | false | 备注信息 |
| seat\_code | string | false | 座位号 店内配送不能为空 |
| settle\_entries | List <SettleEntries> | true | 结算分录 |
| short\_code | string | false | 订单短码 |
| source | integer | false | 支付单编号单据来源，2-商城（酷客多合作伙伴），9-第三方商城，默认2-商城c=1 |

**SettleEntries**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| pay\_type | string | true | 1-微信、2-支付宝、90-会员卡，归属星辰支付类型 ；4-第三方微信、5-第三方支付宝 |
| settle\_amt | string | true | 收款金额 |

**PromotionSummary**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| activity\_id | string | false | 促销活动Id |
| activity\_name | string | false | 促销活动名称 |
| consume\_points | string | false | 消耗积分(优惠类型为 积分低限/兑换时消耗的积分值) |
| coupon\_no | string | false | 优惠券编号 |
| gift\_points | string | false | 促销赠送积分 |
| point\_rule\_id | string | false | 积分兑换(优惠类型为积分兑换)/抵现(优惠类型为积分抵现)规则 |
| promotion\_amt | string | false | 优惠金额 |
| promotion\_type | string | false | 优惠类型 |
| schema\_id | string | false | 促销方案Id |
| schema\_type | string | false | 方案类型 |

**PromotionDetails**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| activity\_id | string | false | 活动Id |
| activity\_name | string | false | 活动名称 |
| activity\_no | string | false | 活动编码 |
| coupon\_no | string | false | 优惠券编号 |
| index | string | false | 商品分录 |
| material\_id | string | false | 商品ID |
| point\_rule\_id | string | false | 积分规则ID |
| promotion\_amt | string | false | 优惠金额 |
| promotion\_schema | string | false | 优惠方案 |
| promotion\_type | string | false | 优惠类型 |
| qty | string | false | 数量 |
| schema\_type | string | false | 方案类型 |
| sku\_id | string | false | skuId |
| unit | string | false | 单位 |

**MemberDeals**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| integral\_add | IntegralAdd | false | 会员相关业务按照类型填充 |
| integral\_exchange | IntegralExchange | false | 核销积分,单据涉及到积分预核销时，该值不能为空 |
| write\_off\_coupons | WriteOffCoupons | false | 优惠券核销，单据涉及到优惠券预核销时，该值不能为空 |

**WriteOffCoupons**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| coupon\_list | List <Coupon> | false | 优惠券核销，单据涉及到优惠券预核销时，该值不能为空 |

**Coupon**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| coupons\_id | string | false | 优惠券ID |
| coupons\_no | string | false | 优惠券编号 |
| money | string | false | 抵扣金额 |

**IntegralExchange**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| money | string | false | 抵扣金额 |
| type | string | false | 操作类型,抵现 2,兑换 3,默认为抵现 |

**IntegralAdd**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| details | List <IntegralDetail> | false | 积分详情数组 |
| member\_card\_id | string | false | 会员卡ID |
| member\_card\_no | string | false | 会员卡编号 |

**IntegralDetail**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| integral | string | false | 积分数量，如果是消耗类型，值为负数，比如抵现 |
| type | string | false | 操作类型,消费积分 1, 抵现 2,兑换 3,充值赠送 4,促销赠送 5,打卡赠送 6,到期清零 7,退款 8,积分购买 9,积分购买退款 10 |

**MaterialEntries**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| material\_id | string | true | 商品Id |
| qty | string | true | 数量 |
| unit\_id | string | true | 单位id |
| all\_amount | string | false | 价税合计 |
| dis\_price | string | false | 折后单价 |
| discount\_fee | string | false | 整单优惠，包括积分抵现金额，优惠券优惠金额 |
| flavor | string | false | 口味商品的口味属性(","分割的文本字段) |
| flavor\_index | string | false | 如果是口味消耗商品,则记录口味商品的分录号，否则为空 |
| free | string | false | 赠品类型 0-非赠品；1-手工赠品；2-促销赠品 |
| index | string | false | 分录标识 |
| package\_list | List <packageList> | false | 套餐编号，当为套餐服务商品时不为空 |
| package\_no | string | false | 套餐编号，当为套餐服务商品时不为空 |
| price | string | true | 单价 |
| sku\_id | string | false | 商品SKU |

**packageList**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| dis\_price | string | false | 实收合计 = disPrice \* qty - discount\_fee |
| material\_id | string | false | 商品id |
| price | string | false | 单价 |
| qty | string | false | 数量 |
| unit\_id | string | false | 单位id |

#### 请求示例

```bash
curl --location --request  post 'https://api.kingdee.com/jdy/v2/ls/retail_bill' \
--header 'Content-Type: application/json' \
--header 'X-Api-ClientID: 205022' \
--header 'X-Api-Auth-Version: 2.0' \
--header 'X-Api-TimeStamp: 1655775240000' \
--header 'X-Api-Nonce: 1655775240000' \
--header 'X-Api-SignHeaders: X-Api-TimeStamp,X-Api-Nonce' \
--header 'X-Api-Signature: xxx' \
--header 'app-token: xxx' \
--header 'X-GW-Router-Addr: https://tf.jdy.com' \
--data-row ' { 	"amt":"10", 	"bal_amount":null, 	"bill_date":"2022-08-12", 	"bill_no":"001", 	"client_id":null, 	"create_time":"2022-08-01 20:10:11", 	"delivery_code":"132123", 	"delivery_end_time":"2022-08-12 12:12:12", 	"delivery_start_time":"2022-08-12 12:12:12", 	"delivery_type":"1", 	"discount_fee":"30", 	"encrypt_key":"1", 	"lack_tip":"1", 	"material_entries":[ 		{ 			"all_amount":"100", 			"dis_price":"300", 			"discount_fee":"001", 			"flavor":"001", 			"flavor_index":"001", 			"free":"1", 			"index":"1", 			"material_id":"1", 			"package_list":[ 				{ 					"dis_price":"50", 					"material_id":"1", 					"price":"001", 					"qty":"50", 					"unit_id":"1" 				} 			], 			"package_no":"001", 			"price":"500", 			"qty":"1", 			"sku_id":"1", 			"unit_id":"1" 		} 	], 	"member_deals":{ 		"integral_add":{ 			"details":[ 				{ 					"integral":"50", 					"type":"1" 				} 			], 			"member_card_id":"1", 			"member_card_no":"001" 		}, 		"integral_exchange":{ 			"money":"50", 			"type":"1" 		}, 		"write_off_coupons":{ 			"coupon_list":[ 				{ 					"coupons_id":"1", 					"coupons_no":"001", 					"money":"50" 				} 			] 		} 	}, 	"member_id":"1", 	"modify_time":"2022-08-01 20:10:11", 	"order_status":"1", 	"promotion_details":[ 		{ 			"activity_id":"1", 			"activity_name":"活动A", 			"activity_no":"001", 			"coupon_no":"001", 			"index":"1", 			"material_id":"0011d=false", 			"point_rule_id":"1", 			"promotion_amt":"50", 			"promotion_schema":"1", 			"promotion_type":"1", 			"qty":"50", 			"schema_type":"1", 			"sku_id":"1", 			"unit":"1" 		} 	], 	"promotion_summary":[ 		{ 			"activity_id":"1", 			"activity_name":"促销活动A", 			"consume_points":"1", 			"coupon_no":"11", 			"gift_points":"50", 			"point_rule_id":"1", 			"promotion_amt":"30", 			"promotion_type":"1", 			"schema_id":"1", 			"schema_type":"1" 		} 	], 	"receiver_address":"默认地址d", 	"receiver_address_id":"默认地址d=false", 	"receiver_latitude":"50", 	"receiver_longitude":"30", 	"receiver_mobile":"13311223344", 	"receiver_name":"收货人A", 	"remark":"备注XXX", 	"seat_code":"50", 	"settle_entries":[ 		{ 			"pay_type":"1", 			"settle_amt":"30" 		} 	], 	"short_code":"200", 	"source":null, 	"src_bill_id":"1", 	"store_id":"1" }'
```

### 响应参数

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| errcode | integer | 返回码，成功时为0 |
| description | string | 返回信息，成功时为success，失败时为具体信息 |
| data | Data | 业务返回具体对象 |

**Data**

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| bill\_id | string | 零售单Id |
| bill\_no | string | 零售单编号 |
| inner\_no | string | 零售单内码 |

#### 响应示例

```json
{
  "data": {
    "bill_id": "1",
    "bill_no": "001",
    "inner_no": "001"
  },
  "description": "success",
  "errcode": 0
}
```

#### 返回码

| 返回码 | 描述 | 解决方案 |
| --- | --- | --- |
| [公告返回码](https://open.jdy.com/#/files/api/detail?index=2&categrayId=1f51c576013945e2af68ef15d4245a48&id=525e704824d24b178ab466530456c037) | 公告返回码 |  |
| 2000002000 | 系统错误,请到开发者社区提单反馈 | [开发者社区](https://vip.kingdee.com/developer?productLineId=29) |
