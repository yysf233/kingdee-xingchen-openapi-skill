---
id: "kdcloud-9d9771b1712511eda0b39ff1b255b8f0"
title: "反预核销"
source: "金蝶云社区"
url: "https://open.jdy.com/#/files/api/detail?index=3&categrayId=&id=9d9771b1712511eda0b39ff1b255b8f0"
author: ""
published_at: ""
product: "金蝶云苍穹"
module: ["零售云", "门店管理"]
language: "Kingscript"
version_hint: ["V2"]
keywords: []
quality: "B"
---

# 反预核销

### 基本信息

-   用途说明：反预核销
-   请求方式：POST
-   请求地址：https://api.kingdee.com/jdy/v2/ls/mall\_pre\_write\_off\_cancel

### 请求参数

#### headers参数

| 参数名称 | 参数示例 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| Content-Type | application/json | true | 固定传：application/json |
| X-Api-ClientID | 205022 | true | 应用id，[创建指引](https://open.jdy.com/#/files/api/detail?index=3&categrayId=316e1f5bd9d711ed8e36c17691e84ff5&id=a540e3dcd9d811ed8e3677dc79b66e86&noside=true) |
| X-Api-Auth-Version | 2.0 | true | 固定传:2.0 |
| X-Api-TimeStamp | 1655775240000 | true | 当前时间毫秒时间戳，有效期为5min |
| X-Api-SignHeaders | X-Api-TimeStamp,X-Api-Nonce | true | 固定传：X-Api-TimeStamp,X-Api-Nonce |
| X-Api-Nonce | 1655775240000 | true | 随机正整数 |
| X-Api-Signature | xxx | true | [参考加密规则](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=b5c26557da9d11ed8e36f9799578d2e1&noside=true) |
| app-token | xxx | true | 产品账套级别的token，[获取指引](https://open.jdy.com/#/files/api/detail?index=3&categrayId=5403e0fd6a5811eda819b759130d6d33&id=9076d1a6da9d11ed8e36874bed64e0be&noside=true) |
| X-GW-Router-Addr | https://tf.jdy.com | true | IDC域名，获取appKey返回消息体内的domain字段 |

#### body参数

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| member\_id | string | true | 会员ID |
| src\_bill\_id | string | true | 商城单据内码（外部对接系统唯一标识），每次预核销，该参数必须不同，否则会当成已经处理，直接返回 |
| member\_deals | MemberDeals | false | 预核销业务类型 |

**MemberDeals**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| consume\_return | ConsumeReturn | false | 退货退款 |
| integral\_now | IntegralNow | false | 优惠券预核销 |
| recharge\_consume | RechargeConsume | false | 会员消费 |
| recharge\_return | RechargeReturn | false | 充值退款 |
| write\_off\_coupons | WriteOffCoupons | false | 优惠券预核销 |

**WriteOffCoupons**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| coupon\_list | List <Coupon> | false | 优惠券 数组 |
| member\_card\_id | string | false | 会员卡ID |
| member\_card\_no | string | false | 会员卡编号 |

**Coupon**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| coupons\_id | string | false | 优惠券ID 可选 |
| coupons\_no | string | false | 优惠券编号 可选 |
| money | string | false | 抵扣金额 |

**RechargeReturn**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| amt | string | false | 退充值预核销金额 |
| member\_card\_id | string | false | 会员卡ID |
| src\_bill\_id | string | false | 原充值单ID |

**RechargeConsume**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| amt | string | false | 会员消费预核销金额 |
| member\_card\_id | string | false | 会员卡ID |
| member\_card\_no | string | false | 会员卡编号 |

**IntegralNow**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| integral | string | false | 核销积分 |
| member\_card\_id | string | false | 会员卡ID |
| member\_card\_no | string | false | 会员卡编号 |

**ConsumeReturn**

| 参数名称 | 参数类型 | 是否必填 | 参数说明 |
| --- | --- | --- | --- |
| member\_card\_id | string | false | 会员卡ID |
| member\_card\_no | string | false | 会员卡编号 |
| return\_amt | string | false | 退充值预核销金额 |
| src\_bill\_id | string | false | 原单ID |

#### 请求示例

```bash
curl --location --request  post 'https://api.kingdee.com/jdy/v2/ls/mall_pre_write_off_cancel' \
--header 'Content-Type: application/json' \
--header 'X-Api-ClientID: 205022' \
--header 'X-Api-Auth-Version: 2.0' \
--header 'X-Api-TimeStamp: 1655775240000' \
--header 'X-Api-Nonce: 1655775240000' \
--header 'X-Api-SignHeaders: X-Api-TimeStamp,X-Api-Nonce' \
--header 'X-Api-Signature: xxx' \
--header 'app-token: xxx' \
--header 'X-GW-Router-Addr: https://tf.jdy.com' \
--data-row ' { 	"member_deals":{ 		"consume_return":{ 			"member_card_id":"1333333333", 			"member_card_no":"1333333333", 			"return_amt":"1333333333", 			"src_bill_id":"1333333333" 		}, 		"integral_now":{ 			"integral":"300", 			"member_card_id":"1333333333", 			"member_card_no":"1333333333" 		}, 		"recharge_consume":{ 			"amt":"30", 			"member_card_id":"1333333333", 			"member_card_no":"1333333333" 		}, 		"recharge_return":{ 			"amt":"300", 			"member_card_id":"1333333333", 			"src_bill_id":"1333333333" 		}, 		"write_off_coupons":{ 			"coupon_list":[ 				{ 					"coupons_id":"1333333333", 					"coupons_no":"1333333333", 					"money":"300" 				} 			], 			"member_card_id":"1333333333", 			"member_card_no":"1333333333" 		} 	}, 	"member_id":"1333333333", 	"src_bill_id":"001" }'
```

### 响应参数

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
| errcode | integer | 返回码，成功时为0 |
| description | string | 返回信息，成功时为success，失败时为具体信息 |
| data | Data | 业务返回具体对象 |

**Data**

| 参数名称 | 参数类型 | 参数说明 |
| --- | --- | --- |
|  | string |  |

#### 响应示例

```json
{
  "data": {},
  "description": "success",
  "errcode": 0
}
```

#### 返回码

| 返回码 | 描述 | 解决方案 |
| --- | --- | --- |
| [公告返回码](https://open.jdy.com/#/files/api/detail?index=2&categrayId=1f51c576013945e2af68ef15d4245a48&id=525e704824d24b178ab466530456c037) | 公告返回码 |  |
| 2000002000 | 系统错误,请到开发者社区提单反馈 | [开发者社区](https://vip.kingdee.com/developer?productLineId=29) |
